<div class="wiki" id="wiki-show">
  <%= render :partial => "sidebar" %>

  <h2 class="title">
    <% if @tag %>
      <%= h @tag.pretty_type_name %>:
    <% end %>

    <% if @page.nil? %>
      <%= h params[:title].tr("_", " ") %>
    <% else %>
      <%= h @page.pretty_title %> <%- unless @page.last_version? -%><span class="old-version">(Version <%= @page.version %>)</span><%- end -%>
    <% end %>
  </h2>

  <% if @page.nil? %>
    <p>No page currently exists.</p>
  <% else %>
    <div id="body">
      <%= format_text(@page.body) %>
    </div>
  <% end %>

  <% if @posts %>
    <div style="margin-top: 1em; float: left; width: 60em;">
      <h4>Recent Posts</h4>
      <div style="margin: 1em 0;">
        <% @posts.each do |p| %>
          <%= print_preview(p) %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%= render :partial => "footer" %>
  
  <div id="footer">
    <% if @page.nil? %>
      <%= link_to "Posts", :controller => "post", :action => "index", :tags => params[:title] %>
      | <%= link_to "Edit", :controller => "wiki", :action => "edit", :title => params[:title] %>
    <% else %>
      <%= link_to "Posts", :controller => "post", :action => "index", :tags => @page.title %>
      | <%= link_to "History", :controller => "wiki", :action => "history", :title => @page.title %>
      <% if not @page.is_locked? %>
        | <%= link_to "Edit", :controller => "wiki", :action => "edit", :title => @page.title, :version => @page.version %>
      <% end %>
      <% if @page.is_locked? %>
        | <%= link_to "Unlock", {:controller => "wiki", :action => "unlock", :title => @page.title}, :method => "post" %>
      <% else %>
        | <%= link_to "Revert", {:controller => "wiki", :action => "revert", :title => @page.title, :version => @page.version}, :confirm => "Are you sure you want to revert to this page?", :method => :post %>
        | <%= link_to "Delete", {:controller => "wiki", :action => "destroy", :title => @page.title}, :confirm => "Are you sure you want to delete this page (and all versions)?", :method => :post %>
        | <%= link_to "Lock", {:controller => "wiki", :action => "lock", :title => @page.title}, :method => :post %>
        | <%= link_to "Rename", :action => "rename", :title => @page.title %>
      <% end %>    
    <% end %>
  </div>
</div>
